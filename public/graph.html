<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <title>Graph</title>
  <link rel="stylesheet" href="./graph.css">
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="./graph-utils.js"></script>
</head>
<body>
  <div id="chartId"></div> 
  <script>
    //Constants for the SVG
    var width = window.innerWidth,
        height = window.innerHeight;

    //Set up the colour scale
    var color = d3.scale.category20();

    //Set up the force layout
    var force = d3.layout.force()
        .charge(-300)
        .linkDistance(60)
        .size([width, height]);

    var svg = d3.select("div#chartId")
       .append("div")
       .classed("svg-container", true) //container class to make it responsive
       .append("svg")
       .attr("preserveAspectRatio", "xMinYMin meet")
       .attr("viewBox", "0 0 "+width + " " + height)
       .classed("svg-content-responsive", true); 

    d3.json('graph.json', data => {

      // Trasnform data as expected by d3 forced graph
      const graph = transformData(data); 

      //Creates the graph data structure out of the json data
      // After this call, graph nodes and links are mutated to 
      // add x,y co-ordinates
      force.nodes(graph.nodes)
          .links(graph.links)
          .start();

      //Create all the line svgs but without locations yet
      var link = svg.selectAll(".link")
          .data(graph.links)
          .enter().append("line")
          .attr("class", "link")
          .style("stroke-width", d => 2)

      //Do the same with the circles for the nodes - no 
      var node = svg.selectAll(".node")
          .data(graph.nodes)
          .enter().append("circle")
          .attr("class", "node")
          .attr("r", 14)
          .attr("fill", "#F42A4D")
          // .style("fill", d => color(d.group))
          .call(force.drag);

      //Now we are giving the SVGs co-ordinates - the force layout is generating the co-ordinates which this code is using to update the attributes of the SVG elements
      force.on("tick", function () {
          link.attr("x1", d => d.source.x)
              .attr("y1", d => d.source.y)
              .attr("x2", d => d.target.x)
              .attr("y2", d => d.target.y);

          node.attr("cx", d => d.x)
              .attr("cy", d => d.y);
      });

    });
  </script>
</body>
</html>
